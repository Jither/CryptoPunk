#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "lucifer.h"

void print_hex(unsigned char *bytes) {
  int i;
  for (i=0;i<16;i++) {
    printf("%02x", bytes[i]);
  }
}

unsigned char convert_hex_digit(char input)
{
    if(input >= '0' && input <= '9')
        return input - '0';
    if(input >= 'A' && input <= 'F')
        return input - 'A' + 10;
    if(input >= 'a' && input <= 'f')
        return input - 'a' + 10;
    return 0xff;
}

int convert_hex(const char *source, unsigned char *dest, int length) {
    int count;
    for(count = 0; count < length; count++) {
        unsigned char h = convert_hex_digit(*source);
        source++;
        unsigned char l = convert_hex_digit(*source);
        source++;
        if (h == 0xff || l == 0xff)
        {
            printf("Invalid hex string");
            return -1;
        }
        dest[count] = h << 4 | l;
    }
    return 0;
}

void generate_vector(const char *keyhex, const char *msghex)
{
    unsigned char key[16];
    unsigned char message[16];

    convert_hex(keyhex, key, 16);
    convert_hex(msghex, message, 16);

    print_hex(message);
    printf(" ");
    print_hex(key);
    printf(" ");

    lucifer_loadkey(key, 0);
    lucifer(message);

    print_hex(message);
    printf("\n");
}

void generate_exercise(const char *keyhex, const char *msghex)
{
    unsigned char key[16];
    unsigned char message[16];

    convert_hex(keyhex, key, 16);
    convert_hex(msghex, message, 16);

    unsigned char *pKey = key;
    unsigned char *pMessage = message;

    printf("Exercise:\n");

    print_hex(message);
    printf(" ");
    print_hex(key);
    printf(" ");

    unsigned char *result;

    for (int i = 0; i < 1000; i++)
    {
        lucifer_loadkey(pKey, 0);
        lucifer(pMessage);

        result = pMessage;
        pMessage = pKey;
        pKey = result;
    }

    print_hex(result);
    printf("\n");
}

int main()
{
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000000");

    generate_vector("00000000000000000000000000000000", "80000000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "40000000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "20000000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "10000000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "08000000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "04000000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "02000000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "01000000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00800000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00400000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00200000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00100000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00080000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00040000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00020000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00010000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00008000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00004000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00002000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00001000000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000800000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000400000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000200000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000100000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000080000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000040000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000020000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000010000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000008000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000004000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000002000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000001000000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000800000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000400000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000200000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000100000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000080000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000040000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000020000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000010000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000008000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000004000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000002000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000001000000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000800000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000400000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000200000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000100000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000080000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000040000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000020000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000010000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000008000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000004000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000002000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000001000000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000800000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000400000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000200000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000100000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000080000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000040000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000020000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000010000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000008000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000004000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000002000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000001000000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000800000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000400000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000200000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000100000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000080000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000040000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000020000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000010000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000008000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000004000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000002000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000001000000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000800000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000400000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000200000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000100000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000080000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000040000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000020000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000010000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000008000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000004000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000002000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000001000000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000800000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000400000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000200000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000100000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000080000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000040000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000020000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000010000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000008000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000004000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000002000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000001000000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000800000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000400000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000200000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000100000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000080000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000040000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000020000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000010000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000008000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000004000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000002000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000001000");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000800");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000400");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000200");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000100");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000080");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000040");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000020");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000010");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000008");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000004");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000002");
    generate_vector("00000000000000000000000000000000", "00000000000000000000000000000001");

    generate_vector("80000000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("40000000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("20000000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("10000000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("08000000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("04000000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("02000000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("01000000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00800000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00400000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00200000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00100000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00080000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00040000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00020000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00010000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00008000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00004000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00002000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00001000000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000800000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000400000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000200000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000100000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000080000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000040000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000020000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000010000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000008000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000004000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000002000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000001000000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000800000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000400000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000200000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000100000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000080000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000040000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000020000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000010000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000008000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000004000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000002000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000001000000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000800000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000400000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000200000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000100000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000080000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000040000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000020000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000010000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000008000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000004000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000002000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000001000000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000800000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000400000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000200000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000100000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000080000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000040000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000020000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000010000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000008000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000004000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000002000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000001000000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000800000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000400000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000200000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000100000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000080000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000040000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000020000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000010000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000008000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000004000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000002000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000001000000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000800000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000400000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000200000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000100000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000080000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000040000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000020000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000010000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000008000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000004000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000002000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000001000000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000800000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000400000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000200000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000100000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000080000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000040000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000020000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000010000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000008000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000004000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000002000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000001000000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000800000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000400000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000200000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000100000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000080000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000040000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000020000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000010000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000008000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000004000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000002000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000001000", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000800", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000400", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000200", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000100", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000080", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000040", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000020", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000010", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000008", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000004", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000002", "00000000000000000000000000000000");
    generate_vector("00000000000000000000000000000001", "00000000000000000000000000000000");

    generate_exercise("0123456789abcdeffedcba9876543210", "00000000000000000000000000000000");
    return 0;
}
